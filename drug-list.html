<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤ ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏™‡∏ß‡∏µ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Sarabun', sans-serif;
            font-size: 16px;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        th {
            cursor: pointer;
            user-select: none;
        }
        th:hover {
            background-color: #e2e8f0;
        }
        /* ‡∏ã‡πà‡∏≠‡∏ô Element ‡πÇ‡∏î‡∏¢‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå */
        .hidden-tab {
            display: none !important;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex flex-col h-screen relative">

    <!-- Header -->
    <header class="bg-blue-800 text-white shadow-md z-10 flex-shrink-0">
        <div class="max-w-7xl mx-auto px-4 py-3 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center gap-2">
            <div class="flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
                <h1 class="text-xl md:text-2xl font-bold tracking-wide">‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤ ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏™‡∏ß‡∏µ</h1>
            </div>
            
            <!-- Tabs Navigation -->
            <div class="flex space-x-1 bg-blue-900 rounded-lg p-1">
                <button id="btn-tab-drug" onclick="switchTab('drug')" class="px-4 py-1.5 text-sm md:text-base rounded-md font-medium transition-colors bg-white text-blue-800 shadow-sm">
                    ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡∏≤ ‡∏£‡∏û.‡∏™‡∏ß‡∏µ
                </button>
                <button id="btn-tab-tmt" onclick="switchTab('tmt')" class="px-4 py-1.5 text-sm md:text-base rounded-md font-medium transition-colors text-blue-100 hover:bg-blue-700 hover:text-white">
                    ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ TMTID
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col overflow-hidden max-w-full mx-auto w-full p-2 sm:p-4 lg:p-6">
        
        <!-- ================= TAB: DRUG (‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏™‡∏ß‡∏µ) ================= -->
        <div id="view-drug" class="flex-1 flex flex-col h-full overflow-hidden">
            <!-- Summary Dashboard (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö 1 ‡πÅ‡∏ñ‡∏ß‡∏û‡∏≠‡∏î‡∏µ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà) -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 mb-3 flex-shrink-0 overflow-hidden">
                <div class="p-1.5 flex flex-nowrap w-full overflow-x-auto no-scrollbar gap-1 text-center justify-between items-stretch">
                    <div class="flex-1 min-w-[35px] bg-gray-50 py-1 px-0.5 rounded border border-gray-100 shadow-sm flex flex-col justify-center">
                        <span class="block text-[10px] md:text-xs text-gray-500 font-medium leading-tight truncate">‡∏£‡∏ß‡∏°</span>
                        <span id="stat-total" class="block text-xs md:text-sm font-bold text-gray-800 leading-none mt-0.5">-</span>
                    </div>
                    <div class="flex-1 min-w-[35px] bg-green-50 py-1 px-0.5 rounded border border-green-100 shadow-sm flex flex-col justify-center">
                        <span class="block text-[10px] md:text-xs text-green-600 font-medium leading-tight truncate">E</span>
                        <span id="stat-e" class="block text-xs md:text-sm font-bold text-green-700 leading-none mt-0.5">-</span>
                    </div>
                    <div class="flex-1 min-w-[35px] bg-red-50 py-1 px-0.5 rounded border border-red-100 shadow-sm flex flex-col justify-center">
                        <span class="block text-[10px] md:text-xs text-red-600 font-medium leading-tight truncate">N</span>
                        <span id="stat-n" class="block text-xs md:text-sm font-bold text-red-700 leading-none mt-0.5">-</span>
                    </div>
                    <div class="flex-1 min-w-[35px] bg-blue-50 py-1 px-0.5 rounded border border-blue-100 shadow-sm flex flex-col justify-center">
                        <span class="block text-[10px] md:text-xs text-blue-600 font-medium leading-tight truncate">‡∏Å</span>
                        <span id="stat-kor" class="block text-xs md:text-sm font-bold text-blue-700 leading-none mt-0.5">-</span>
                    </div>
                    <div class="flex-1 min-w-[35px] bg-blue-50 py-1 px-0.5 rounded border border-blue-100 shadow-sm flex flex-col justify-center">
                        <span class="block text-[10px] md:text-xs text-blue-600 font-medium leading-tight truncate">‡∏Ç</span>
                        <span id="stat-khor" class="block text-xs md:text-sm font-bold text-blue-700 leading-none mt-0.5">-</span>
                    </div>
                    <div class="flex-1 min-w-[35px] bg-blue-50 py-1 px-0.5 rounded border border-blue-100 shadow-sm flex flex-col justify-center">
                        <span class="block text-[10px] md:text-xs text-blue-600 font-medium leading-tight truncate">‡∏Ñ</span>
                        <span id="stat-kor-kway" class="block text-xs md:text-sm font-bold text-blue-700 leading-none mt-0.5">-</span>
                    </div>
                    <div class="flex-1 min-w-[35px] bg-blue-50 py-1 px-0.5 rounded border border-blue-100 shadow-sm flex flex-col justify-center">
                        <span class="block text-[10px] md:text-xs text-blue-600 font-medium leading-tight truncate">‡∏á</span>
                        <span id="stat-ngor" class="block text-xs md:text-sm font-bold text-blue-700 leading-none mt-0.5">-</span>
                    </div>
                    <div class="flex-1 min-w-[35px] bg-blue-50 py-1 px-0.5 rounded border border-blue-100 shadow-sm flex flex-col justify-center">
                        <span class="block text-[10px] md:text-xs text-blue-600 font-medium leading-tight truncate">‡∏à(1)</span>
                        <span id="stat-jor1" class="block text-xs md:text-sm font-bold text-blue-700 leading-none mt-0.5">-</span>
                    </div>
                </div>
            </div>

            <!-- Controls: Search & Filter (Drug) -->
            <div class="bg-white p-3 rounded-t-lg shadow-sm border-b border-gray-200 flex flex-col md:flex-row gap-3 items-center justify-between flex-shrink-0">
                <div class="relative w-full md:w-1/2">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-4 w-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <input type="text" id="searchDrug" class="block w-full pl-9 pr-3 py-1.5 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤, ‡∏£‡∏´‡∏±‡∏™..." oninput="filterDrugData()">
                </div>
                
                <div class="flex items-center">
                    <input id="rpstFilter" type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded cursor-pointer" onchange="filterDrugData()">
                    <label for="rpstFilter" class="ml-2 block text-sm text-gray-900 cursor-pointer">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡∏£‡∏û.‡∏™‡∏ï.</label>
                </div>
            </div>

            <!-- Table Container (Drug) -->
            <div class="flex-1 overflow-auto bg-white shadow-sm rounded-b-lg border-x border-b border-gray-200 relative">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-100 sticky top-0 z-10 shadow-sm">
                        <tr>
                            <th scope="col" class="px-2 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider w-10 text-center">‡∏£‡∏π‡∏õ</th>
                            <th scope="col" class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortDrug('name')">‡∏ä‡∏∑‡πà‡∏≠‡∏¢‡∏≤ <span id="sort-drug-name" class="text-gray-400">‚ÜïÔ∏è</span></th>
                            <th scope="col" class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortDrug('trade_name')">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ <span id="sort-drug-trade_name" class="text-gray-400"></span></th>
                            <th scope="col" class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortDrug('code')">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ö‡∏¥‡∏Å <span id="sort-drug-code" class="text-gray-400"></span></th>
                            <th scope="col" class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortDrug('working_code')">HosXP <span id="sort-drug-working_code" class="text-gray-400"></span></th>
                            <th scope="col" class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortDrug('tmtid')">TMTID <span id="sort-drug-tmtid" class="text-gray-400"></span></th>
                            <th scope="col" class="px-2 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortDrug('per_pack')">‡∏ö‡∏£‡∏£‡∏à‡∏∏ <span id="sort-drug-per_pack" class="text-gray-400"></span></th>
                            <th scope="col" class="px-2 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortDrug('unit')">‡∏´‡∏ô‡πà‡∏ß‡∏¢ <span id="sort-drug-unit" class="text-gray-400"></span></th>
                            <th scope="col" class="px-3 py-2 text-right text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortDrug('price')">‡∏£‡∏≤‡∏Ñ‡∏≤ <span id="sort-drug-price" class="text-gray-400"></span></th>
                            <th scope="col" class="px-2 py-2 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortDrug('category')">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏¢‡∏≤ <span id="sort-drug-category" class="text-gray-400"></span></th>
                            <th scope="col" class="px-2 py-2 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortDrug('ed')">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ <span id="sort-drug-ed" class="text-gray-400"></span></th>
                            <th scope="col" class="px-2 py-2 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortDrug('list')">‡∏¢‡πà‡∏≠‡∏¢ <span id="sort-drug-list" class="text-gray-400"></span></th>
                            <th scope="col" class="px-2 py-2 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortDrug('subdistrict_list')">‡∏£‡∏û.‡∏™‡∏ï. <span id="sort-drug-subdistrict_list" class="text-gray-400"></span></th>
                        </tr>
                    </thead>
                    <tbody id="tableBodyDrug" class="bg-white divide-y divide-gray-200 text-sm">
                        <!-- Data will be injected here -->
                    </tbody>
                </table>
                <div id="noDataDrug" class="hidden flex flex-col items-center justify-center py-8 text-gray-500">
                    <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
                </div>
            </div>
        </div>

        <!-- ================= TAB: TMT (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á) ================= -->
        <div id="view-tmt" class="hidden-tab flex-1 flex flex-col h-full overflow-hidden">
            
            <!-- Note & Search -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-3 mb-3 rounded-r-lg flex-shrink-0">
                <div class="flex items-center">
                    <svg class="h-5 w-5 text-yellow-500 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/></svg>
                    <p class="text-sm text-yellow-700 font-medium">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• TMT ‡∏ã‡∏∂‡πà‡∏á<span class="font-bold underline">‡∏£‡∏ß‡∏°‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô ‡∏£‡∏û.‡∏™‡∏ß‡∏µ</span> ‡∏î‡πâ‡∏ß‡∏¢</p>
                </div>
            </div>

            <div class="bg-white p-3 rounded-t-lg shadow-sm border-b border-gray-200 flex flex-col md:flex-row gap-3 items-center justify-between flex-shrink-0">
                <div class="relative w-full md:w-2/3">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-4 w-4 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <input type="text" id="searchTmt" class="block w-full pl-9 pr-3 py-1.5 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤ (Trade Name), FSN, ‡∏´‡∏£‡∏∑‡∏≠ TMTID..." oninput="filterTmtData()">
                </div>
                <div class="text-sm text-gray-500">
                    ‡∏û‡∏ö: <span id="countIndicatorTmt" class="font-bold text-gray-800">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                </div>
            </div>

            <!-- Table Container (TMT) -->
            <div class="flex-1 overflow-auto bg-white shadow-sm rounded-b-lg border-x border-b border-gray-200 relative">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-100 sticky top-0 z-10 shadow-sm">
                        <tr>
                            <th scope="col" class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortTmt('tmtid')">TMTID <span id="sort-tmt-tmtid" class="text-gray-400">‚ÜïÔ∏è</span></th>
                            <th scope="col" class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortTmt('trade_name')">Trade Name <span id="sort-tmt-trade_name" class="text-gray-400"></span></th>
                            <th scope="col" class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortTmt('fsn')">FSN <span id="sort-tmt-fsn" class="text-gray-400"></span></th>
                            <th scope="col" class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortTmt('active_ingredient')">Active Ingredient <span id="sort-tmt-active_ingredient" class="text-gray-400"></span></th>
                            <th scope="col" class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Strength / Form</th>
                            <th scope="col" class="px-3 py-2 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortTmt('manufacturer')">Manufacturer <span id="sort-tmt-manufacturer" class="text-gray-400"></span></th>
                            <th scope="col" class="px-3 py-2 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider" onclick="sortTmt('status')">Status <span id="sort-tmt-status" class="text-gray-400"></span></th>
                        </tr>
                    </thead>
                    <tbody id="tableBodyTmt" class="bg-white divide-y divide-gray-200 text-sm">
                        <!-- Data will be injected here -->
                    </tbody>
                </table>
                <div id="noDataTmt" class="hidden flex flex-col items-center justify-center py-8 text-gray-500">
                    <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
                </div>
            </div>
        </div>

    </main>

    <!-- Modal ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤ (‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤) -->
    <div id="drugModal" class="fixed inset-0 z-[100] hidden bg-gray-900 bg-opacity-60 flex items-center justify-center p-4 transition-opacity">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col relative" onclick="event.stopPropagation()">
            <!-- Header Modal -->
            <div class="px-4 py-3 border-b border-gray-200 flex justify-between items-center bg-blue-50">
                <h3 class="text-lg font-bold text-blue-800" id="modalTitle">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡∏≤</h3>
                <button onclick="closeModal()" class="text-gray-400 hover:text-gray-700 bg-white hover:bg-gray-200 rounded-full p-1 transition-colors shadow-sm">
                    <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            
            <!-- Content Modal -->
            <div class="p-4 md:p-6 overflow-y-auto" id="modalContent">
                <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ JavaScript -->
            </div>
            
            <!-- Footer Modal -->
            <div class="px-4 py-3 border-t border-gray-200 bg-gray-50 text-right">
                <button onclick="closeModal()" class="px-4 py-2 bg-blue-600 text-white text-sm rounded shadow hover:bg-blue-700 transition-colors">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
            </div>
        </div>
    </div>

    <!-- Global Loading Status -->
    <div id="globalLoader" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-white px-4 py-2 rounded-full shadow-lg border border-gray-200 flex items-center gap-2 z-50 text-sm font-medium transition-opacity duration-300">
        <svg class="animate-spin h-4 w-4 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <span id="loaderText" class="text-blue-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
    </div>

    <!-- Toast Notification (‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ Copy) -->
    <div id="copyToast" class="fixed bottom-6 right-6 z-[60] transform transition-all duration-300 translate-y-20 opacity-0 bg-gray-800 text-white px-5 py-3 rounded-lg shadow-xl flex items-center gap-3">
        <svg class="h-6 w-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <span id="toastMessage" class="font-medium">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß</span>
    </div>

    <script>
        const webAppUrl = "https://script.google.com/macros/s/AKfycbxbljVfMbph_tJysEVEZ-EFyyvc25LQiGTnFmT771tHHziwujRmmv6zP96gTOsWbAmg/exec";
        
        // State
        let allDrugs = [], filteredDrugs = [];
        let allTmt = [], filteredTmt = [];
        let currentTab = 'drug'; // 'drug' or 'tmt'
        let drugSort = { column: 'name', direction: 'asc' };
        let tmtSort = { column: 'tmtid', direction: 'asc' };
        let isTmtLoaded = false;

        const rawSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="#9ca3af"><rect width="100%" height="100%" fill="#f3f4f6"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>`;
        const errorImageSVG = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(rawSvg);

        // ================= Tab Management =================
        function switchTab(tab) {
            currentTab = tab;
            const btnDrug = document.getElementById('btn-tab-drug');
            const btnTmt = document.getElementById('btn-tab-tmt');
            const viewDrug = document.getElementById('view-drug');
            const viewTmt = document.getElementById('view-tmt');

            if (tab === 'drug') {
                btnDrug.className = "px-4 py-1.5 text-sm md:text-base rounded-md font-medium transition-colors bg-white text-blue-800 shadow-sm";
                btnTmt.className = "px-4 py-1.5 text-sm md:text-base rounded-md font-medium transition-colors text-blue-100 hover:bg-blue-700 hover:text-white";
                viewDrug.classList.remove('hidden-tab');
                viewTmt.classList.add('hidden-tab');
            } else {
                btnTmt.className = "px-4 py-1.5 text-sm md:text-base rounded-md font-medium transition-colors bg-white text-blue-800 shadow-sm";
                btnDrug.className = "px-4 py-1.5 text-sm md:text-base rounded-md font-medium transition-colors text-blue-100 hover:bg-blue-700 hover:text-white";
                viewTmt.classList.remove('hidden-tab');
                viewDrug.classList.add('hidden-tab');

                if (!isTmtLoaded) fetchTmt();
            }
        }

        // ================= Fetch Data =================
        async function fetchDrug() {
            showLoader("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡∏≤ ‡∏£‡∏û.‡∏™‡∏ß‡∏µ...");
            try {
                const response = await fetch(`${webAppUrl}?sheet=drug`);
                const result = await response.json();
                if (result.status === 'success') {
                    allDrugs = result.data;
                    filteredDrugs = [...allDrugs];
                    updateSummary(allDrugs);
                    executeDrugSort();
                    hideLoaderSuccess("‡πÇ‡∏´‡∏•‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                } else {
                    hideLoaderError(result.message);
                }
            } catch (error) {
                hideLoaderError("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ");
            }
        }

        async function fetchTmt() {
            showLoader("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• TMT (‡∏≠‡∏≤‡∏à‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà)...");
            try {
                const response = await fetch(`${webAppUrl}?sheet=tmt`);
                const result = await response.json();
                if (result.status === 'success') {
                    allTmt = result.data;
                    filteredTmt = [...allTmt];
                    isTmtLoaded = true;
                    executeTmtSort();
                    hideLoaderSuccess("‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• TMT ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                } else {
                    hideLoaderError("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• TMT (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Google Apps Script ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)");
                }
            } catch (error) {
                hideLoaderError("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ");
            }
        }

        // ================= Drug Logic =================
        function updateSummary(data) {
            const safeTrim = (str) => (str || '').toString().trim();
            document.getElementById('stat-total').innerText = data.length.toLocaleString();
            document.getElementById('stat-e').innerText = data.filter(d => safeTrim(d.ed) === 'E').length.toLocaleString();
            document.getElementById('stat-n').innerText = data.filter(d => safeTrim(d.ed) === 'N').length.toLocaleString();
            document.getElementById('stat-kor').innerText = data.filter(d => safeTrim(d.list) === '‡∏Å').length.toLocaleString();
            document.getElementById('stat-khor').innerText = data.filter(d => safeTrim(d.list) === '‡∏Ç').length.toLocaleString();
            document.getElementById('stat-kor-kway').innerText = data.filter(d => safeTrim(d.list) === '‡∏Ñ').length.toLocaleString();
            document.getElementById('stat-ngor').innerText = data.filter(d => safeTrim(d.list) === '‡∏á').length.toLocaleString();
            document.getElementById('stat-jor1').innerText = data.filter(d => safeTrim(d.list) === '‡∏à(1)').length.toLocaleString();
        }

        function filterDrugData() {
            const term = document.getElementById('searchDrug').value.toLowerCase().trim();
            const showOnlyRpst = document.getElementById('rpstFilter').checked;

            filteredDrugs = allDrugs.filter(drug => {
                if (showOnlyRpst && drug.subdistrict_list !== '/') return false;
                if (term === '') return true;
                return Object.values(drug).some(v => v && String(v).toLowerCase().includes(term));
            });
            executeDrugSort();
        }

        function sortDrug(column) {
            if (drugSort.column === column) drugSort.direction = drugSort.direction === 'asc' ? 'desc' : 'asc';
            else { drugSort.column = column; drugSort.direction = 'asc'; }

            document.querySelectorAll('#view-drug th span').forEach(s => s.innerText = '');
            document.getElementById('sort-drug-' + column).innerText = drugSort.direction === 'asc' ? ' üîº' : ' üîΩ';
            executeDrugSort();
        }

        function executeDrugSort() {
            const { column, direction } = drugSort;
            filteredDrugs.sort((a, b) => {
                let vA = a[column] || '', vB = b[column] || '';
                if(!isNaN(vA) && !isNaN(vB) && vA !== '' && vB !== '') { vA = Number(vA); vB = Number(vB); } 
                else { vA = String(vA).toLowerCase(); vB = String(vB).toLowerCase(); }
                if (vA < vB) return direction === 'asc' ? -1 : 1;
                if (vA > vB) return direction === 'asc' ? 1 : -1;
                return 0;
            });
            renderDrugTable();
        }

        function renderDrugTable() {
            const tbody = document.getElementById('tableBodyDrug');
            const noData = document.getElementById('noDataDrug');
            
            if (filteredDrugs.length === 0) {
                tbody.innerHTML = '';
                noData.classList.remove('hidden');
                return;
            }
            noData.classList.add('hidden');
            
            let html = '';
            filteredDrugs.forEach((drug, index) => {
                const imgSrc = drug.image || errorImageSVG;
                let edBadge = '-';
                if(drug.ed === 'E') edBadge = `<span class="px-1.5 py-0.5 inline-flex text-xs font-semibold rounded bg-green-100 text-green-800">E</span>`;
                else if(drug.ed === 'N') edBadge = `<span class="px-1.5 py-0.5 inline-flex text-xs font-semibold rounded bg-red-100 text-red-800">N</span>`;
                else if(drug.ed) edBadge = `<span class="px-1.5 py-0.5 inline-flex text-xs font-semibold rounded bg-gray-100 text-gray-800">${drug.ed}</span>`;

                const isRpst = drug.subdistrict_list === '/' ? `<span class="text-green-500 font-bold">‚úì</span>` : `<span class="text-gray-300">-</span>`;

                html += `
                    <tr class="hover:bg-blue-100 transition-colors cursor-pointer" onclick="openModal(${index})">
                        <td class="px-2 py-1.5 text-center"><img src="${imgSrc}" loading="lazy" class="h-5 w-5 rounded object-cover border border-gray-300 mx-auto" onerror="this.src='${errorImageSVG}'"></td>
                        <td class="px-3 py-1.5 whitespace-normal min-w-[150px] font-medium text-gray-900 leading-tight">${drug.name || '-'}</td>
                        <td class="px-3 py-1.5 text-gray-500">${drug.trade_name || '-'}</td>
                        <td class="px-3 py-1.5 text-gray-500">${drug.code || '-'}</td>
                        <td class="px-3 py-1.5 font-mono text-gray-700">${drug.working_code || '-'}</td>
                        <td class="px-3 py-1.5 font-mono text-blue-600">
                            <div class="flex items-center gap-1">
                                <span>${drug.tmtid || '-'}</span>
                                ${drug.tmtid ? `<button onclick="copyTmtid(event, '${drug.tmtid}')" class="text-gray-400 hover:text-blue-800"><svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg></button>` : ''}
                            </div>
                        </td>
                        <td class="px-2 py-1.5 text-gray-500">${drug.per_pack || '-'}</td>
                        <td class="px-2 py-1.5 text-gray-500">${drug.unit || '-'}</td>
                        <td class="px-3 py-1.5 text-right font-semibold text-blue-600">${drug.price ? Number(drug.price).toFixed(2) : '-'}</td>
                        <td class="px-2 py-1.5 text-center text-gray-500 text-xs">${drug.category || '-'}</td>
                        <td class="px-2 py-1.5 text-center">${edBadge}</td>
                        <td class="px-2 py-1.5 text-center text-gray-600 font-medium">${drug.list || '-'}</td>
                        <td class="px-2 py-1.5 text-center">${isRpst}</td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        // ================= TMT Logic =================
        function filterTmtData() {
            const term = document.getElementById('searchTmt').value.toLowerCase().trim();
            filteredTmt = allTmt.filter(item => {
                if (term === '') return true;
                // ‡πÄ‡∏ô‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å FSN, TradeName, ‡πÅ‡∏•‡∏∞ TMTID
                return (item.fsn && item.fsn.toLowerCase().includes(term)) || 
                       (item.trade_name && item.trade_name.toLowerCase().includes(term)) ||
                       (item.tmtid && item.tmtid.toString().toLowerCase().includes(term)) ||
                       (item.active_ingredient && item.active_ingredient.toLowerCase().includes(term));
            });
            executeTmtSort();
        }

        function sortTmt(column) {
            if (tmtSort.column === column) tmtSort.direction = tmtSort.direction === 'asc' ? 'desc' : 'asc';
            else { tmtSort.column = column; tmtSort.direction = 'asc'; }

            document.querySelectorAll('#view-tmt th span').forEach(s => s.innerText = '');
            document.getElementById('sort-tmt-' + column).innerText = tmtSort.direction === 'asc' ? ' üîº' : ' üîΩ';
            executeTmtSort();
        }

        function executeTmtSort() {
            const { column, direction } = tmtSort;
            filteredTmt.sort((a, b) => {
                let vA = String(a[column] || '').toLowerCase(), vB = String(b[column] || '').toLowerCase();
                if (vA < vB) return direction === 'asc' ? -1 : 1;
                if (vA > vB) return direction === 'asc' ? 1 : -1;
                return 0;
            });
            renderTmtTable();
        }

        function renderTmtTable() {
            const tbody = document.getElementById('tableBodyTmt');
            const noData = document.getElementById('noDataTmt');
            document.getElementById('countIndicatorTmt').innerText = filteredTmt.length.toLocaleString();

            if (filteredTmt.length === 0) {
                tbody.innerHTML = '';
                noData.classList.remove('hidden');
                return;
            }
            noData.classList.add('hidden');
            
            let html = '';
            filteredTmt.forEach((item) => {
                // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Status
                let statusBadge = '-';
                if(item.status === 'Active' || item.status === 'A') statusBadge = `<span class="px-2 py-0.5 inline-flex text-xs font-semibold rounded bg-green-100 text-green-800">Active</span>`;
                else if(item.status) statusBadge = `<span class="px-2 py-0.5 inline-flex text-xs font-semibold rounded bg-gray-100 text-gray-600">${item.status}</span>`;

                html += `
                    <tr class="hover:bg-blue-50 transition-colors">
                        <td class="px-3 py-2 font-mono text-blue-700 font-medium">
                            <div class="flex items-center gap-2">
                                ${item.tmtid || '-'}
                                ${item.tmtid ? `<button onclick="copyToClipboard('${item.tmtid}')" class="text-gray-400 hover:text-blue-800"><svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg></button>` : ''}
                            </div>
                        </td>
                        <td class="px-3 py-2 whitespace-normal min-w-[150px] font-medium text-gray-900 leading-tight">${item.trade_name || '-'}</td>
                        <td class="px-3 py-2 whitespace-normal min-w-[200px] text-gray-600 leading-tight text-sm">${item.fsn || '-'}</td>
                        <td class="px-3 py-2 whitespace-normal text-gray-700 text-sm">${item.active_ingredient || '-'}</td>
                        <td class="px-3 py-2 text-gray-600 text-sm">${item.strength || '-'} <br> <span class="text-xs text-gray-400">${item.dosageform || '-'}</span></td>
                        <td class="px-3 py-2 text-gray-500 text-sm whitespace-normal min-w-[150px]">${item.manufacturer || '-'}</td>
                        <td class="px-3 py-2 text-center">${statusBadge}</td>
                    </tr>
                `;
            });
            tbody.innerHTML = html;
        }

        // ================= Modal & Utilities =================
        function openModal(index) {
            const drug = filteredDrugs[index];
            const modal = document.getElementById('drugModal');
            const content = document.getElementById('modalContent');
            const imgSrc = drug.image || errorImageSVG;

            let edBadge = '-';
            if(drug.ed === 'E') edBadge = `<span class="px-2 py-0.5 inline-flex text-xs font-semibold rounded bg-green-100 text-green-800">‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (E)</span>`;
            else if(drug.ed === 'N') edBadge = `<span class="px-2 py-0.5 inline-flex text-xs font-semibold rounded bg-red-100 text-red-800">‡∏ô‡∏≠‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (N)</span>`;
            else if(drug.ed) edBadge = `<span class="px-2 py-0.5 inline-flex text-xs font-semibold rounded bg-gray-100 text-gray-800">${drug.ed}</span>`;

            content.innerHTML = `
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="w-full md:w-1/3 flex flex-col items-center">
                        <img src="${imgSrc}" class="w-full max-w-[180px] h-auto aspect-square object-cover rounded-lg border border-gray-200 shadow-sm mb-3" onerror="this.src='${errorImageSVG}'">
                        <div class="w-full text-center">
                            <span class="block text-xl font-bold text-blue-700">${drug.price ? Number(drug.price).toFixed(2) + ' ‡∏ø' : '-'}</span>
                            <span class="block text-xs text-gray-500">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ (${drug.unit || '-'})</span>
                        </div>
                    </div>
                    
                    <div class="w-full md:w-2/3">
                        <h4 class="text-xl md:text-2xl font-bold text-gray-900 mb-1">${drug.name || '-'}</h4>
                        <h5 class="text-sm md:text-base text-gray-500 mb-4 font-medium">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏≤: ${drug.trade_name || '-'}</h5>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-y-3 gap-x-4">
                            <div class="border-b border-gray-100 pb-1.5">
                                <span class="block text-[11px] text-gray-400 uppercase tracking-wider">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ö‡∏¥‡∏Å (CODE)</span>
                                <span class="block text-sm font-medium text-gray-800">${drug.code || '-'}</span>
                            </div>
                            <div class="border-b border-gray-100 pb-1.5">
                                <span class="block text-[11px] text-gray-400 uppercase tracking-wider">‡∏£‡∏´‡∏±‡∏™ HosXP</span>
                                <span class="block text-sm font-medium text-gray-800 font-mono">${drug.working_code || '-'}</span>
                            </div>
                            <div class="border-b border-gray-100 pb-1.5 sm:col-span-2">
                                <span class="block text-[11px] text-gray-400 uppercase tracking-wider">‡∏£‡∏´‡∏±‡∏™ TMTID</span>
                                <div class="flex items-center gap-2">
                                    <span class="block text-sm font-medium text-blue-600 font-mono">${drug.tmtid || '-'}</span>
                                    ${drug.tmtid ? `<button onclick="copyTmtid(event, '${drug.tmtid}')" class="text-gray-400 hover:text-blue-600" title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å TMTID"><svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg></button>` : ''}
                                </div>
                            </div>
                            <div class="border-b border-gray-100 pb-1.5">
                                <span class="block text-[11px] text-gray-400 uppercase tracking-wider">‡∏ö‡∏£‡∏£‡∏à‡∏∏ / ‡∏´‡∏ô‡πà‡∏ß‡∏¢</span>
                                <span class="block text-sm font-medium text-gray-800">${drug.per_pack || '-'} ${drug.unit || '-'}</span>
                            </div>
                            <div class="border-b border-gray-100 pb-1.5">
                                <span class="block text-[11px] text-gray-400 uppercase tracking-wider">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏¢‡∏≤</span>
                                <span class="block text-sm font-medium text-gray-800">${drug.category || '-'}</span>
                            </div>
                            <div class="border-b border-gray-100 pb-1.5">
                                <span class="block text-[11px] text-gray-400 uppercase tracking-wider">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡∏≤ / ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡πà‡∏≠‡∏¢</span>
                                <span class="block text-sm mt-0.5">${edBadge} <span class="ml-1 text-gray-600 font-semibold">${drug.list || ''}</span></span>
                            </div>
                            <div class="border-b border-gray-100 pb-1.5 sm:col-span-2">
                                <span class="block text-[11px] text-gray-400 uppercase tracking-wider">‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï/‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</span>
                                <span class="block text-sm font-medium text-gray-800">${drug.company || '-'}</span>
                            </div>
                            <div class="pb-1.5 sm:col-span-2">
                                <span class="block text-[11px] text-gray-400 uppercase tracking-wider mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡∏£‡∏û.‡∏™‡∏ï.</span>
                                ${drug.subdistrict_list === '/' ? 
                                    `<span class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[11px] font-medium bg-green-100 text-green-800"><svg class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg> ‡∏°‡∏µ‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡∏≤ ‡∏£‡∏û.‡∏™‡∏ï.</span>` : 
                                    `<span class="inline-flex items-center gap-1 px-2 py-0.5 rounded text-[11px] font-medium bg-gray-100 text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏¢‡∏≤ ‡∏£‡∏û.‡∏™‡∏ï.</span>`
                                }
                            </div>
                        </div>
                    </div>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('drugModal').classList.add('hidden');
        }

        // ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏î‡∏≥
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('drugModal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
        });

        // Wrapper ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏î‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß Modal ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏î‡πâ‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤
        function copyTmtid(event, text) {
            if(event) event.stopPropagation();
            copyToClipboard(text);
        }

        function copyToClipboard(text) {
            if (!text || text === '-') return;
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.opacity = "0";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            try {
                document.execCommand('copy');
                showToast(`‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å TMTID: ${text} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`);
            } catch (err) {
                showToast(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ`);
            }
            document.body.removeChild(textArea);
        }

        function showToast(message) {
            const toast = document.getElementById('copyToast');
            document.getElementById('toastMessage').innerText = message;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 2500);
        }

        function showLoader(msg) {
            const loader = document.getElementById('globalLoader');
            document.getElementById('loaderText').innerText = msg;
            loader.classList.remove('opacity-0', 'pointer-events-none');
        }

        function hideLoaderSuccess(msg) {
            const loader = document.getElementById('globalLoader');
            const txt = document.getElementById('loaderText');
            txt.innerText = msg;
            txt.classList.replace('text-blue-600', 'text-green-600');
            loader.querySelector('svg').classList.replace('text-blue-600', 'text-green-500');
            loader.querySelector('svg').classList.remove('animate-spin');
            
            setTimeout(() => {
                loader.classList.add('opacity-0', 'pointer-events-none');
                // Reset loader styles for next use
                setTimeout(() => {
                    txt.classList.replace('text-green-600', 'text-blue-600');
                    loader.querySelector('svg').classList.replace('text-green-500', 'text-blue-600');
                    loader.querySelector('svg').classList.add('animate-spin');
                }, 300);
            }, 2000);
        }

        function hideLoaderError(msg) {
            const loader = document.getElementById('globalLoader');
            const txt = document.getElementById('loaderText');
            txt.innerText = "‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + msg;
            txt.classList.replace('text-blue-600', 'text-red-600');
            loader.querySelector('svg').classList.replace('text-blue-600', 'text-red-500');
            loader.querySelector('svg').classList.remove('animate-spin');
        }

        // Start
        fetchDrug();

    </script>
</body>
</html>